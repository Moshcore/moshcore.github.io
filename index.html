<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>女王大人的百宝箱</title>
    <link rel="stylesheet" type="text/css" href="./assets/index.css">
</head>

<body>
    <div class="container">
        <!-- 左侧导航栏 -->
        <nav class="sidebar">
            <h2>功能导航</h2>
            <button class="nav-button active" onclick="loadPage('home', 'welcome.html')">
                <span class="icon">🏠</span> 首页
            </button>
            <button class="nav-button" onclick="loadPage('user_import', 'user_import.html')">
                <span class="icon">🙍</span> 用户导入
            </button>
            <button class="nav-button" onclick="loadPage('quiz_import', 'quiz_import.html')">
                <span class="icon">📋</span> 试题导入
            </button>
            <button class="nav-button" onclick="loadPage('aggregate', 'aggregate.html')">
                <span class="icon">📊</span> 数据汇总
            </button>
            <button class="nav-button" onclick="loadPage('deduplication', 'deduplication.html')">
                <span class="icon">📊</span> 数据去重
            </button>
            <button class="nav-button" onclick="loadPage('settings', 'config.html')">
                <span class="icon">⚙️</span> 系统设置
            </button>
            <button class="nav-button" onclick="loadPage('help', 'https://example.com/help')">
                <span class="icon">❓</span> 帮助中心
            </button>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 顶部工具栏 -->
            <div class="toolbar">
                <div class="current-page" id="currentPageTitle">首页</div>
                <div class="toolbar-buttons">
                    <button class="toolbar-button" onclick="refreshCurrentPage()" title="刷新">
                        🔄
                    </button>
                    <button class="toolbar-button" onclick="goBack()" title="后退">
                        ⬅️
                    </button>
                    <button class="toolbar-button" onclick="goForward()" title="前进">
                        ➡️
                    </button>
                </div>
            </div>

            <!-- iframe容器 -->
            <div class="iframe-container">
                <!-- 加载提示 -->
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>正在加载...</p>
                </div>

                <!-- 错误提示 -->
                <div class="error-message" id="errorMessage">
                    <p>⚠️ 页面加载失败</p>
                    <p>请检查网络连接或稍后重试</p>
                </div>

                <!-- iframe元素 -->
                <iframe id="home" class="active"></iframe>
                <iframe id="user_import" src=""></iframe>
                <iframe id="quiz_import" src=""></iframe>
                <iframe id="aggregate" src=""></iframe>
                <iframe id="deduplication" src=""></iframe>
                <iframe id="settings" src=""></iframe>
                <iframe id="help" src=""></iframe>
            </div>
        </main>
    </div>
    <script>
        // 当前活动的iframe
        let currentIframe = 'home';

        // 页面URL映射
        const pageUrls = {
            'home': 'welcome.html',
            'user_import': 'user_import.html',
            'quiz_import': 'quiz_import.html',
            'aggregate': 'aggregate.html',
            'deduplication': 'deduplication.html',
            'settings': 'config.html',
            'help': 'https://example.com/help'
        };

        // 页面标题映射
        const pageTitles = {
            'home': '首页',
            'user_import': '用户导入',
            'quiz_import': '试题导入',
            'aggregate': '数据分析',
            'deduplication': '数据去重',
            'settings': '系统设置',
            'help': '帮助中心'
        };

        // 加载页面函数
        function loadPage(pageId, url) {
            // 显示加载提示
            showLoading();
            hideError();


            // 隐藏所有iframe
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                iframe.classList.remove('active');
            });

            // 移除所有按钮的active类
            const buttons = document.querySelectorAll('.nav-button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });

            // 获取目标iframe
            const targetIframe = document.getElementById(pageId);
            // 如果iframe还没有加载过，设置src
            if (!targetIframe.src || targetIframe.src === 'about:blank' || targetIframe.src != pageUrls[pageId]) {
                targetIframe.src = url || pageUrls[pageId];

                // 监听加载完成事件
                targetIframe.onload = function () {
                    hideLoading();
                    targetIframe.classList.add('active');
                    const fetchStr = fetch.toString();
                    if(!fetchStr.includes('[native code]')){
                        targetIframe.contentWindow.fetch = window.fetch
                    }
                };

                // 监听加载错误事件
                targetIframe.onerror = function () {
                    hideLoading();
                    showError();
                };
            } else {
                // 如果已经加载过，直接显示
                hideLoading();
                targetIframe.classList.add('active');
            }

            // 高亮选中的按钮
            const clickedButton = event.target.closest('.nav-button');
            if (clickedButton) {
                clickedButton.classList.add('active');
            }

            // 更新当前页面标题
            document.getElementById('currentPageTitle').textContent = pageTitles[pageId];

            // 更新当前iframe引用
            currentIframe = pageId;

            // 保存当前页面到localStorage
            localStorage.setItem('currentPage', pageId);
        }

        // 刷新当前页面
        function refreshCurrentPage() {
            const iframe = document.getElementById(currentIframe);
            if (iframe && iframe.src) {
                showLoading();
                iframe.src = iframe.src;
                iframe.onload = function () {
                    hideLoading();
                };
            }
        }

        // 后退功能
        function goBack() {
            const iframe = document.getElementById(currentIframe);
            if (iframe && iframe.contentWindow) {
                try {
                    iframe.contentWindow.history.back();
                } catch (e) {
                    console.log('无法访问iframe历史记录');
                }
            }
        }

        // 前进功能
        function goForward() {
            const iframe = document.getElementById(currentIframe);
            if (iframe && iframe.contentWindow) {
                try {
                    iframe.contentWindow.history.forward();
                } catch (e) {
                    console.log('无法访问iframe历史记录');
                }
            }
        }

        // 显示加载提示
        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        // 隐藏加载提示
        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        // 显示错误提示
        function showError() {
            document.getElementById('errorMessage').classList.add('active');
        }

        // 隐藏错误提示
        function hideError() {
            document.getElementById('errorMessage').classList.remove('active');
        }

        // 页面加载时恢复上次访问的页面
        window.onload = function () {
            const savedPage = localStorage.getItem('currentPage');
            if (savedPage && savedPage !== 'home') {
                // 找到对应的按钮并触发点击
                const buttons = document.querySelectorAll('.nav-button');
                buttons.forEach(button => {
                    if (button.textContent.includes(pageTitles[savedPage])) {
                        button.click();
                    }
                });
            }
        }

        // 监听所有iframe的加载事件
        document.querySelectorAll('iframe').forEach(iframe => {
            iframe.addEventListener('load', function () {
                hideLoading();
            });
        });
    </script>
</body>

</html>